# SOC Automation: Wazuh + Shuffle Malware Triage

This project demonstrates a fully automated Security Operations Center (SOC) workflow. It uses **Wazuh** for endpoint detection, **Sysmon** for deep visibility, **Shuffle** for security orchestration (SOAR), and **VirusTotal** for threat enrichment, ultimately sending a formatted email alert for confirmed malware.

---

## ðŸ“º Demo

/screenshots/Demo.gif

## ðŸš€ Features

* **Endpoint Detection:** Uses Wazuh and Sysmon to detect malicious file execution on a Windows 10 endpoint.
* **Automated Ingestion:** A Shuffle workflow automatically ingests alerts from the Wazuh server.
* **Threat Enrichment:** Automatically extracts the file hash (SHA256) from the alert and queries the VirusTotal API to determine if it's malicious.
* **Automated Response:** If the file is confirmed malicious, a high-priority alert email is sent to the SOC team.

---

## ðŸ› ï¸ Tech Stack

* **SIEM/Detection:** Wazuh Server (on a cloud VM)
* **Endpoint:** Windows 10 (VirtualBox) with Sysmon & Wazuh Agent
* **SOAR:** Shuffler.io 
* **Threat Intelligence:** VirusTotal API
* **Notification:** Custom Email (via SMTP)

---

## ðŸ›ï¸ Architecture Diagram

This diagram shows the flow of data from detection to notification.



*(**Your action:** Create a simple diagram using a tool like `draw.io` or `Lucidchart`, export it as a `.png`, and add it to your `/screenshots/` folder. Then, replace the text above with a link to it.)*

---

## ðŸ”§ Setup & Configuration

Here are the high-level steps to reproduce this environment.

### 1. Wazuh Server

A Wazuh server was deployed on a cloud provider (Oracle Cloud Infrastructure (OCI)).
* Followed the [Wazuh installation guide](https://documentation.wazuh.com/current/installation-guide/index.html).
* Ensured TCP ports 1514 (agent registration) and 1515 (agent communication) were open.

### 2. Windows 10 Endpoint (Wazuh Agent)

1.  **VM Setup:** A Windows 10 VM was created in VirtualBox.
2.  **Sysmon:** Sysmon was installed and configured using a custom XML configuration file.
    * See the configuration used: [`/config_examples/sysmon_config.xml`](/config_examples/sysmon_config.xml)
3.  **Wazuh Agent:** The Wazuh agent was installed and configured to report to the Wazuh server's IP address.
    * See the agent config block: [`/config_examples/wazuh_agent_ossec.conf`](/config_examples/wazuh_agent_ossec.conf)

### 3. Shuffle Workflow

The entire automation is handled by a Shuffle workflow.

> **You can import the complete workflow from this file:** [`/shuffle_workflow/wazuh-vt-alert.json`](/shuffle_workflow/wazuh-vt-alert.json)

The workflow performs the following steps:
1.  **Wazuh Trigger:** Listens for new alerts from the Wazuh API.
2.  **Extract Hash:** Parses the alert JSON to extract the `data.sha256` field.
3.  **VirusTotal:** Queries the VirusTotal `/file/report` API endpoint with the extracted hash.
4.  **Send Alert:** If the file is found to be malicious, it uses the **Email** app to send the formatted alert to the analyst team.

---

## ðŸ”¬ How to Test (Demonstration)

1.  **Execute Malware:** On the Windows 10 VM, download and "execute" a test file. (I used Mimikatz.exe for a safe demonstration).
2.  **Detection:** The Wazuh agent detects the program execution using Sysmon and forwards the alert (with the file hash) to the Wazuh server.
3.  **Automation:** The Shuffle workflow triggers, ingests the alert, queries VirusTotal, and confirms the file is malicious.
4.  **Notification:** An email alert is sent to the specified inbox.

### Example Alert

Here is a screenshot of the final alert email generated by the workflow.



*(**Your action:** Take a screenshot of the email you received, add it to `/screenshots/`, and link it here.)*

---

## ðŸ“ˆ Future Improvements

This project is a foundation. Here are some ideas for extending it:
* **Host Isolation:** Add a workflow step to call a script that adds a firewall rule to the endpoint, isolating it from the network.
* **Ticket Creation:** Automatically create a ticket in a system like **Jira** or **TheHive**.
* **Slack/Teams:** Send a notification to a SOC chat channel in addition to the email.
* **Delete File:** Add a step to execute a Wazuh Active Response command to delete the malicious file from the endpoint.

---

## ðŸ“„ License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.
